<!DOCTYPE html>
<html lang="en">

<head>
	<!--script src="titlepage.js" type = "text/javascript"></script-->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<script src="scripts/utils.js"></script>
	<script src="scripts/CanvasInput.js"></script>

	<!--game scripts-->
	<script src="scripts/Enemy.js"></script>
</head>
<!-- SCRIPTS GO HERE -->

<body onload="init();">

<canvas id="canvas" width="800" height="650" style="border:1px solid #c3c3c3;">
Your browser does not support the HTML5 canvas tag.
</canvas>

<script>
	//CONSTANTS
	var CANVAS_WIDTH = 800;
	var CANVAS_HEIGHT = 650;
	var ENEMY_PROBABILITY_PER_SECOND = 1.0;

	var ctx;
	var lastTime = 0;
	var enemies = [];

	function init(){
		var c=document.getElementById("canvas");
		ctx=c.getContext("2d");
		//ctx.fillStyle="#FF0000";
		//ctx.fillRect(0,0,150,75);//things to do before we begin the game
		console.log("test");

		startGameOne();
	}
	
	//actually starting the game (FIRST ONE IS THE TECH SHOOTER GAME)
	function startGameOne(){
		animate();
	}
	
	function animate(){
		var dt = calculateDeltaTime();
			
			//if(!paused) {
				// 1)update sprites
				update(dt);
				
				// 2)draw background
				drawBackground();
				
				// 3)draw everything else
				drawSprites();
			//} //end if
			
			//tell the browser to let us know when its ready to animate -
			//which is usually in 1/60 of a second
			//animate is the function that will be "called back"
			window.requestAnimFrame(animate);
			
			//console.log("animating...");
	}

	function update(dt){
		//Enemies
			enemies.forEach(function(enemy){
				enemy.update(dt);
			});
			
			enemies.filter(function(enemy){
				return enemy.active;
			});
			
			if(Math.random() < ENEMY_PROBABILITY_PER_SECOND/180){
				enemies.push(new Enemy(CANVAS_WIDTH,CANVAS_HEIGHT-100));
				console.log("New Enemy created! enemies.length = " +
					enemies.length);
			}
	}

	function drawBackground(){
		//console.log("drawing background");
		/*var grad = ctx.createLinearGradient(0,0,0,CANVAS_HEIGHT);
			grad.addColorStop(0,"#993D7A"); //top
			grad.addColorStop(.40,"#CC3300"); //40% down
			grad.addColorStop(.85, "blue"); //85% down
			grad.addColorStop(1,"#aa44ff"); //bottom
			
			//Fill entire ctx with gradient
			ctx.fillStyle = grad; //before we were using solid colors*/
			ctx.fillStyle = "#FFFFFF";
			ctx.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT-100);
	}

	function drawSprites(){
		//console.log("drawing sprites");
		enemies.forEach(function(enemy) {
				ctx.fillStyle = "#000000";
				enemy.draw(ctx);
			});
	}



	///HELPER FUNCTIONS

	function calculateDeltaTime() {
			//whats with (+ new Date)?
			// + calls Date.valueOf(), which converts it from an object to a 
			//primitive (number of milliseconds since January 1, 1970)
			var now,fps;
			now = (+new Date);
			fps = 1000/(now - lastTime);
			fps = clamp(fps,12,60);
			lastTime = now;
			return 1/fps;
		
		}
	var input = new CanvasInput({  canvas: document.getElementById('canvas'), fontSize: 18,  fontWeight: 'bold', x: 100, y: 550, width: 700, height: 100,  padding: 8,  borderWidth: 1,  borderColor: '#C0C0C0',  borderRadius: 3,  boxShadow: '0px 0px 0px #fff',  innerShadow: '0px 0px 0px rgba(0, 0, 0, 0)',  placeHolder: 'Kill those enemies!!'});


</script>

</body>

</html>

